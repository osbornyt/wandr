<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    {% load static %}
    <link href="{% static 'dashboard.css' %}" rel="stylesheet">
    <!-- <link href="{% static 'resource.css' %}" rel="stylesheet"> -->

</head>

<body>
    <div id="sidebar">
        <div class="app-name">
            <h1>W&R</h1>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'main:dashboard' %}"> <i class="fas fa-chart-line"></i><span>Dashboard</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'main:resource_order' %}"><i class="fas fa-file-alt"></i><span>Resource Orders</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'main:fetch_shift_ticket' %}"><i class="fas fa-wpforms"></i><span>Shift Tickets</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'main:exhibit_e' %}"><i class="fas fa-folder"></i><span>Evaluations</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'main:pageholder' %}"><i class="fas fa-folder"></i><span>Profile</span></a>
            </li>
        </ul>
        <span id="menu-toggle"><i class="fas fa-arrow-left"></i></span> </div>
    <div id="content">
        <div id="content-top" class="navbar navbar-expand-lg">
            <div class="container-fluid">

                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
                <ul class="mynavbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'main:pageholder' %}"><i class="fas fa-question-circle fa-icon"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'main:pageholder' %}"><i class="fas fa-bell fa-icon"></i></a>
                    </li>
                    <!-- <li class="nav-item">
                        <div class="prof-circle" >
                            <div class="profile-circle">{{ initials }}</div>
                        </div>
                        
                    </li> -->
                    <li class="nav-item dropdown">  
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false"> 
                        <div class="prof-circle" >
                            <div class="profile-circle">{{ initials }}</div>
                        </div> 
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                            <div class="user-info">
                                <div class="profile-circle">{{ initials }}</div>
                                <div class="name-username">
                                    <div>{{ username }}</div>
                                    <div class="text-muted">{{ first_name }} {{ last_name }}</div>
                                </div>
                                
                            </div>
                            
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{% url 'main:pageholder' %}"><i class="fas fa-cog"></i>My Settings</a></li>
                        <li><a class="dropdown-item" href="{% url 'main:pageholder' %}"><i class="fas fa-user-plus"></i>Refer a friend</a></li>
                        <li><a class="dropdown-item" href="{% url 'main:pageholder' %}"><i class="fas fa-question-circle"></i>Help Center</a></li>
                        <li><a class="dropdown-item" href="{% url 'main:logout' %}"><i class="fas fa-sign-out-alt"></i>Sign Out</a></li>
                    </ul>
                </li>
            
                </ul>
            </div>
        </div>
        
        <div id="content-bottom">
            <input id="userid" type="hidden" value="{{user_id}}">
            <input id="formid" type="hidden" value="{{form_id}}">
            <input id="userformid" type="hidden" value="{{user_form_id}}">
            <div id="content-main">
                
            </div>
            <main id="main_section" class="container">
                <section id="uploadSection" class="{% if uploaded_forms %}hidden{% endif %}">
                    <h2>New Emergency Shift Ticket</h2>
                    <div class="form-container">
                    <div class="main-info" style="max-width: 750px;">
                        <p>This multi-page form is designed to capture 
                            comprehensive information related to equipment 
                            usage, incident reporting, etc. It is divided 
                            into several sections, each focusing on specific
                             details. Please ensure all required fields are
                              completed accurately.
                        </p>
                    </div>
                    <div class="main-info" style="max-width: 750px; margin-top: 10px; margin-bottom: 10px;">
                       <div class="form-group" style="display: flex; align-items: center; justify-content: center;">
                            <select id="projectDropdown" name="project" class="form-control" style="text-align:center">
                                <option value="" selected>--- Select a Project or Leave Blank for Manual Entry ---</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_name }}</option>
                                {% empty %}
                                {% endfor %}
                            </select>
                        </div> 
                    </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 2rem;">
                            <div id="clearform" class="clear-form" onclick="hide_new()">
                                <i class="fas fa-eye-slash"></i> <span>Hide</span>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="create_shift_ticket()" style="background-color: var(--primary-color); border: none;">Begin</button>
                        </div>
                    
                </div>
                    
                    
                </section>
                <section id="formsListSection" class="{% if not uploaded_forms %}hidden{% endif %}">
                    <h2>Emergency Shift Tickets</h2>
                    <div id="noFormsMessage" class="info-message {% if uploaded_forms %}hidden{% endif %}">
                        <p><i class="fas fa-info-circle"></i> No Resource Order forms have been uploaded yet.</p>
                        <p>To begin, please provide company name, agreement number and upload your Resource Order PDF form.
                            Alternatively you can manually input the required fields.
                        </p>
                    </div>

                    <span class="add-resource-order-link" onclick="handleAddNewRO()">
                        <i class="fas fa-plus-circle"></i> Add New Resource Order
                    </span>
                    
                    <div id="uploadedFormsList">
                        {% for form_item in uploaded_forms %}
                        <div class="form-card">
                            <h3><i class="fas fa-file-pdf"></i> {{ form_item.name }}</h3>
                            <p><strong>ID:</strong> {{ form_item.id }}</p>
                            <p><strong>Completion:</strong> {{ form_item.curr_question }}/19</p>
                            <p><strong>Date:</strong> {{ form_item.created_at|date:"M d, Y" }}</p>
                            <div class="card-actions">
                                <a href="" target="_blank" class="{% if not form_item.curr_question == 6 %}hidden{% endif %} btn btn-info btn-sm preview-btn">
                                    <i class="fas fa-eye"></i> Preview
                                </a>
                                <a onclick="continue_form_filling('{{ form_item.id}} ')"  class="btn btn-info btn-sm continue-btn">
                                    <i class="fas fa-arrow-right"></i> {% if not form_item.curr_question == 6 %}Continue{% else %}Edit{% endif %}
                                </a>
                                <form action="{% url 'main:delete_Shift_ticket' form_item.id %}" method="post" onsubmit="return confirm('Are you sure you want to delete this form?');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm delete-btn">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </form>
                                
                            </div>
                        </div>
                        {% empty %}
                        {% endfor %}
                    </div>
                </section>
                
            </main>

            <div id="content-right">
                    <div style="width: 180px;" class="card">
                        <a href="{% url 'main:pageholder' %}" class="card-link" >
                            <h6 class="card-title">Complete your Profile</h6>
                                    
                            <div class="card-body" id="progress-card" style="display: flex; justify-content: center; align-items: center;">
                            <div class="progress-circle" style="--progress-percentage: 30; ">                           <svg viewBox="0 0 69 69">#}
                                    <circle cx="50%" cy="50%" r="30"></circle>
                                        <circle class="progress-value" cx="50%" cy="50%" r="30"></circle>
                                    </svg>
                                    <div class="progress-text">30%</div>
                                </div>
                                
                            </div>
                            <p style="margin: 5px" class="card-text">Please complete your user profile information to ensure accurate documentation.</p>
                        </a>
                </div>
            

                
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
     {% load static %}
    <!-- <script src="{% static 'dash.js' %}"></script> -->
    <script>
        const sidebar = document.getElementById('sidebar');
        const contentMain = document.getElementById('content-main');
        const menuToggle = document.getElementById('menu-toggle');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            contentMain.classList.toggle('collapsed');
        });
        function handleAddNewRO() {
            document.getElementById("uploadSection").classList.remove('hidden');
        }
        function hide_new(){
            document.getElementById("uploadSection").classList.add('hidden');
        }
        
    </script>
    {% load static %}
    <script src="{% static 'fetch_form_fill.js' %}"></script>
</body>

</html>

{% extends "base.html" %}
{% block styles %}
{% load static %}
<link rel="stylesheet" href="{% static 'signup.css' %}">
{% endblock styles %}


{% block content %}
    <div class="container">
      <br/>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
      <div class="col-md-6 offset-md-3">
        
        <form id="signupform" method="POST" action="">
          <h1>Register VIPR Account</h1>
          {% csrf_token %}
          {{ form.as_p }}
          <br/>
            <button type="submit" >Register</button>
            <a href="{% url 'main:home' %}" class="button-cancel">Cancel</a>
        </form>
        
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('signupform');

  form.addEventListener('submit', function (event) {
    let errors = [];

    const username = form.querySelector('input[name="username"]');
    const email = form.querySelector('input[name="email"]');
    const password1 = form.querySelector('input[name="password1"]');
    const password2 = form.querySelector('input[name="password2"]');

    const password = password1.value.trim();
    const commonPasswords = ['123456', 'password', 'qwerty', '12345678', '111111'];

    // Required field checks
    if (!username.value.trim()) errors.push('Username is required.');
    if (!email.value.trim()) {
      errors.push('Email is required.');
    } else if (!/^\S+@\S+\.\S+$/.test(email.value)) {
      errors.push('Enter a valid email address.');
    }

    // Password validations
    if (!password) {
      errors.push('Password is required.');
    } else {
      if (password.length < 8) {
        errors.push('Password must be at least 8 characters long.');
      }

      if (/^\d+$/.test(password)) {
        errors.push('Password cannot be entirely numeric.');
      }

      if (commonPasswords.includes(password.toLowerCase())) {
        errors.push('Password is too common.');
      }

      const personalInfo = [username.value.trim(), email.value.trim()];
      for (let info of personalInfo) {
        if (info && password.toLowerCase().includes(info.toLowerCase())) {
          errors.push("Password can't be too similar to your personal information.");
          break;
        }
      }
    }

    if (password !== password2.value.trim()) {
      errors.push('Passwords do not match.');
    }

    // If errors, prevent form submission
    if (errors.length > 0) {
      event.preventDefault();
      alert(errors.join('\n'));
    }
  });
});
</script>

    {% endblock content %}